@page "/"
@using FollowTheMoney.Models
@rendermode InteractiveServer

<PageTitle>FTM</PageTitle>

<h1>Welcome to FTM</h1>
<p>Follow the Money helps you find information about politicians and their financial disclosures.</p>

<SearchBar OnSearchCompleted="@HandleSearchResults" />

@if (searchResults != null && searchResults.Any())
{
    <div class="results mt-3">
        <h3>Search Results (@searchResults.Count):</h3>
        <div class="list-group">
            @foreach (var politician in searchResults)
            {
                <a href="/politician/@politician.Id" class="list-group-item list-group-item-action">
                    <h5>@politician.FullName</h5>
                    <p class="mb-1"><strong>Position:</strong> @politician.Position</p>
                    <p class="mb-1"><strong>Electoral Division:</strong> @politician.ElectoralDivision, @politician.State</p>
                </a>
            }
        </div>
    </div>
}
else
{
    <p class="text-muted mt-3">No search results yet. Try searching for a politician.</p>
}

@code {
    private List<Politician>? searchResults;

    private Task HandleSearchResults(List<Politician> results)
    {
        Console.WriteLine($"Home received {results.Count} results");
        searchResults = results;
        StateHasChanged();
        return Task.CompletedTask;
    }
}